<nav class="bg-white shadow fixed inset-x-0 top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-14 md:h-16 flex items-center justify-between">
    <button (click)="goToLanding()" class="cursor-pointer">
      <span class="text-lg md:text-xl font-bold text-gray-900">Vaultiva</span>
    </button>
    <button (click)="goToLogin()"
            class="bg-[#364d79] text-white! px-3 py-1.5 md:px-4 md:py-2 rounded-xl text-xs md:text-sm hover:bg-[#2C3E50]">
      Login
    </button>
  </div>
</nav>

<main class="pt-14 md:pt-16">
  <div class="px-3 md:px-4">
      <app-demo-banner></app-demo-banner>
  </div>
  
  <section class="max-w-6xl mx-auto px-3 md:px-4">
      <nz-steps
        [nzCurrent]="step()"
        nzSize="small"
        nzLabelPlacement="vertical"
        class="pt-3 pb-4 overflow-x-auto"
      >
        <nz-step nzTitle="Choose file"></nz-step>
        <nz-step nzTitle="Protect"></nz-step>
        <nz-step nzTitle="Get link"></nz-step>
      </nz-steps>
      
      <ng-container [ngSwitch]="step()">
          <!-- STEP 0: File rack -->
          <div *ngIf="step() === 0" class="mt-4">
            <p class="text-xs md:text-sm text-gray-500 mb-3 md:mb-4">
              This demo uses dummy files with persistent watermarks.
            </p>
          
            <div class="grid gap-3 md:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
              <nz-card *ngFor="let f of allFiles"
                       class="rounded-2xl shadow hover:shadow-md transition-shadow min-h-[200px] md:min-h-[220px]">
                <div class="space-y-1 px-3 py-3">
                  <div class="font-semibold text-sm md:text-base">{{ f.label }}</div>
                  <div class="text-[11px] md:text-xs text-gray-500">{{ f.name }} • {{ f.size || '—' }}</div>
                  <div class="text-[11px] md:text-xs text-gray-500">{{ f.description }}</div>
                </div>
          
                <div class="px-3 pb-3">
                  <button nz-button nzType="primary" class="w-full" (click)="selectFile(f)">Use this file</button>
                </div>
              </nz-card>
            </div>
          </div>
          
          <!-- STEP 1: Protect form -->
          <div *ngIf="step() === 1" class="max-w-3xl mx-auto mt-4">
            <nz-card class="rounded-2xl shadow">
              <!-- Selected -->
              <div class="mb-4 px-2 md:px-0">
                <div class="text-xs md:text-sm text-gray-500">Selected file</div>
                <div class="font-semibold">{{ selected()?.label }}</div>
                <div class="text-[11px] md:text-xs text-gray-500">{{ selected()?.name }} • {{ selected()?.size }}</div>
              </div>
          
              <form [formGroup]="form" class="space-y-4 md:space-y-5">
          
                <!-- Password toggle -->
                <div class="grid sm:grid-cols-12 gap-2 items-center">
                  <div class="sm:col-span-4 text-sm">Password protection</div>
                  <div class="sm:col-span-8"><nz-switch formControlName="passwordEnabled"></nz-switch></div>
                </div>
          
                <!-- Password input -->
                <div *ngIf="form.value.passwordEnabled" class="grid sm:grid-cols-12 gap-2">
                  <div class="sm:col-span-4"></div>
                  <div class="sm:col-span-8">
                    <input nz-input type="password" formControlName="password" placeholder="Default: 1234">
                    <div class="text-[11px] md:text-xs text-gray-500 mt-1">For demo only. Hint: 1234</div>
                  </div>
                </div>
          
                <!-- Expiry -->
                <div class="grid sm:grid-cols-12 gap-2">
                  <div class="sm:col-span-4 text-sm">Expire after</div>
                  <div class="sm:col-span-8">
                    <nz-radio-group formControlName="expiryPreset" class="flex flex-col gap-1.5 md:gap-2">
                      <label nz-radio nzValue="1h">1 hour</label>
                      <label nz-radio nzValue="24h">24 hours</label>
                      <label nz-radio nzValue="3d">3 days</label>
                      <label nz-radio nzValue="7d">7 days</label>
                      <label nz-radio nzValue="custom">Custom</label>
                    </nz-radio-group>
                    <div *ngIf="form.value.expiryPreset === 'custom'" class="mt-2">
                      <nz-date-picker formControlName="expiryCustom"></nz-date-picker>
                    </div>
                  </div>
                </div>
          
                <!-- Download limit -->
                <div class="grid sm:grid-cols-12 gap-2 items-center">
                  <div class="sm:col-span-4 text-sm">Download limit</div>
                  <div class="sm:col-span-8"><nz-switch formControlName="limitEnabled"></nz-switch></div>
                </div>
          
                <div *ngIf="form.value.limitEnabled" class="grid sm:grid-cols-12 gap-2">
                  <div class="sm:col-span-4"></div>
                  <div class="sm:col-span-8">
                    <nz-input-number [nzMin]="1" [nzMax]="10" formControlName="downloadLimit"></nz-input-number>
                    <div class="text-[11px] md:text-xs text-gray-500 mt-1">Number of allowed downloads</div>
                  </div>
                </div>
          
                <!-- Visibility -->
                <div class="grid sm:grid-cols-12 gap-2 items-center">
                  <div class="sm:col-span-4 text-sm">Visibility</div>
                  <div class="sm:col-span-8 flex gap-4">
                    <nz-radio-group formControlName="visibility" class="flex gap-4">
                      <label nz-radio nzValue="Restricted">Restricted</label>
                      <label nz-radio nzValue="Public">Public</label>
                    </nz-radio-group>
                  </div>
                </div>
          
                <!-- Actions -->
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2">
                  <button nz-button nzType="default" class="w-full sm:w-auto" (click)="backToFiles()">Back</button>
                  <button nz-button nzType="primary" class="w-full sm:w-auto" (click)="generateLink()">Generate Demo Link</button>
                </div>
          
                <div class="text-[11px] md:text-xs text-gray-500 pt-1 md:pt-2">
                  This is a simulated demo. No real files are uploaded.
                </div>
              </form>
            </nz-card>
          </div>
          
          <!-- STEP 2: Link result -->
          <div *ngIf="step() === 2" class="mt-4">
            <nz-card class="rounded-2xl shadow space-y-3 max-w-lg mx-auto">
              <span class="font-semibold">Your demo link is ready</span>
              <input nz-input [value]="linkUrl()" readonly>
              <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 mt-2">
                <button nz-button nzType="default" class="w-full sm:w-auto" (click)="copyLink()">Copy</button>
                <button nz-button nzType="primary" class="w-full sm:w-auto" (click)="openPreview()">Open Preview</button>
              </div>
              <div class="text-[11px] md:text-xs text-gray-500 mt-1">
                Links created here only work in this browser session.
              </div>
            </nz-card>
          </div>
      </ng-container>
  </section>
</main>
