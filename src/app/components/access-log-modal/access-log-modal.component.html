<div class="mx-auto max-w-full">
  <div class="flex border-b">
    <button
      class="px-4 py-2"
      [ngClass]="{
        'text-blue-600 border-b-2 border-blue-600 font-semibold': activeTab === 'fileLog',
        'text-gray-600 hover:text-blue-600': activeTab !== 'fileLog'
      }"
      (click)="setActiveTab('fileLog')"
    >
      File Access Log
    </button>
    <button
      class="px-4 py-2"
      [ngClass]="{
        'text-blue-600 border-b-2 border-blue-600 font-semibold': activeTab === 'failedLog',
        'text-gray-600 hover:text-blue-600': activeTab !== 'failedLog'
      }"
      (click)="setActiveTab('failedLog')"
    >
      File Failed Access Log
    </button>
  </div>

  <!-- File Access Log Tab -->
  <div class="p-4" *ngIf="activeTab === 'fileLog'">
    <ng-container *ngIf="!isLoading && dataSet.data.length === 0; else fileLogContent">
      <nz-empty
        nzNotFoundImage="simple"
        [nzNotFoundContent]="
          'No access logs available '
            + ' '
        "
      >
        <ng-template #contentTpl>
          <span>
            No access logs available
            <span
              nz-tooltip
              nzTooltipTitle="This will show who accessed or attempted to access the file."
            >
              <nz-icon nzType="question-circle" class="ml-1 text-gray-400"></nz-icon>
            </span>
          </span>
        </ng-template>
      </nz-empty>
    </ng-container>

    <ng-template #fileLogContent>
      <!-- Desktop Table -->
      <nz-table
        *ngIf="!isMobile"
        #basicTable
        [nzData]="dataSet.data"
        [nzPageSize]="dataSet.limit"
        [nzPageIndex]="dataSet.page"
        [nzTotal]="dataSet.total"
        [nzShowPagination]="true"
        [nzLoading]="isLoading"
        (nzPageIndexChange)="onPageChange($event)"
        [nzFrontPagination]="false"
        [nzScroll]="{ y: '50em' }"
        class="min-w-full"
      >
        <thead>
          <tr>
            <th>Accessed At</th>
            <th>Email</th>
            <th>Ip Address</th>
            <th>Browser & OS</th>
            <th>Access Type</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of basicTable.data">
            <td>{{ formatDateWithTime(data.accessedAt) }} WIB</td>
            <td [class]="data.email ? '' : 'text-center'">{{ data.email || '-' }}</td>
            <td>
              {{ data.ipAddress === '::1' ? 'localhost (::1)' : data.ipAddress }}
              <button
                nz-button
                nzSize="small"
                nzType="text"
                nz-tooltip="Copy IP"
                (click)="copyToClipboard(data.ipAddress)"
              >
                <nz-icon nzType="copy" nzTheme="outline"></nz-icon>
              </button>
            </td>
            <td>
              {{ data.userAgent | userAgentParser }}
              <button
                nz-button
                nzSize="small"
                nzType="text"
                nz-tooltip="Copy User Agent"
                (click)="copyToClipboard(data.userAgent)"
              >
                <nz-icon nzType="copy" nzTheme="outline"></nz-icon>
              </button>
            </td>
            <td>{{ data.email === null ? 'Uploader' : 'External User' }}</td>
          </tr>
        </tbody>
      </nz-table>

      <!-- Mobile Card List -->
      <div *ngIf="isMobile" class="space-y-4">
        <div
          *ngFor="let data of dataSet.data"
          class="p-4 bg-white rounded shadow flex flex-col gap-2"
        >
          <div>
            <span class="font-semibold">Accessed At:</span> {{ formatDateWithTime(data.accessedAt) }}
            WIB
          </div>
          <div><span class="font-semibold">Email:</span> {{ data.email || '-' }}</div>
          <div class="flex items-center justify-between">
            <span>
              <span class="font-semibold">IP Address:</span>
              {{ data.ipAddress === '::1' ? 'localhost (::1)' : data.ipAddress }}
            </span>
            <button
              nz-button
              nzType="text"
              nzSize="small"
              nz-tooltip="Copy IP"
              (click)="copyToClipboard(data.ipAddress)"
            >
              <nz-icon nzType="copy" nzTheme="outline"></nz-icon>
            </button>
          </div>
          <div class="flex items-center justify-between">
            <span><span class="font-semibold">Browser & OS:</span> {{ data.userAgent | userAgentParser }}</span>
            <button
              nz-button
              nzType="text"
              nzSize="small"
              nz-tooltip="Copy User Agent"
              (click)="copyToClipboard(data.userAgent)"
            >
              <nz-icon nzType="copy" nzTheme="outline"></nz-icon>
            </button>
          </div>
          <div>
            <span class="font-semibold">Access Type:</span>
            {{ data.email === null ? 'Uploader' : 'External User' }}
          </div>
        </div>

        <!-- Pagination Mobile -->
        <nz-pagination
          [nzPageIndex]="dataSet.page"
          [nzTotal]="dataSet.total"
          [nzPageSize]="dataSet.limit"
          (nzPageIndexChange)="onPageChange($event)"
          [nzSimple]="true"
          class="mt-4"
        >
        </nz-pagination>
      </div>
    </ng-template>
  </div>

  <!-- File Failed Access Log Tab -->
  <div class="p-4" *ngIf="activeTab === 'failedLog'">
    <ng-container *ngIf="!isLoading && dataSet.data.length === 0; else failedLogContent">
      <nz-empty
        nzNotFoundImage="simple"
        [nzNotFoundContent]="
          'No failed access logs found '
            + ' '
        "
      >
        <ng-template #contentTpl>
          <span>
            No failed access logs found
            <span
              nz-tooltip
              nzTooltipTitle="This will show who accessed or attempted to access the file."
            >
              <nz-icon nzType="question-circle" class="ml-1 text-gray-400"></nz-icon>
            </span>
          </span>
        </ng-template>
      </nz-empty>
    </ng-container>

    <ng-template #failedLogContent>
      <!-- Desktop Table -->
      <nz-table
        *ngIf="!isMobile"
        #basicTable
        [nzData]="dataSet.data"
        [nzPageSize]="dataSet.limit"
        [nzPageIndex]="dataSet.page"
        [nzTotal]="dataSet.total"
        [nzShowPagination]="true"
        [nzLoading]="isLoading"
        (nzPageIndexChange)="onPageChange($event)"
        [nzFrontPagination]="false"
        [nzScroll]="{ y: '50em' }"
        class="min-w-full"
      >
        <thead>
          <tr>
            <th>Accessed At</th>
            <th>Email</th>
            <th>Ip Address</th>
            <th>User Agent</th>
            <th>Reason</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of basicTable.data">
            <td>{{ formatDateWithTime(data.accessedAt) }} WIB</td>
            <td class="text-center">{{ data.email || '-' }}</td>
            <td>
              {{ data.ipAddress === '::1' ? 'localhost (::1)' : data.ipAddress }}
              <button
                nz-button
                nzSize="small"
                nzType="text"
                nz-tooltip="Copy IP"
                (click)="copyToClipboard(data.ipAddress)"
              >
                <nz-icon nzType="copy" nzTheme="outline"></nz-icon>
              </button>
            </td>
            <td>
              {{ data.userAgent | userAgentParser }}
              <button
                nz-button
                nzSize="small"
                nzType="text"
                nz-tooltip="Copy User Agent"
                (click)="copyToClipboard(data.userAgent)"
              >
                <nz-icon nzType="copy" nzTheme="outline"></nz-icon>
              </button>
            </td>
            <td>{{ data.reason }}</td>
          </tr>
        </tbody>
      </nz-table>

      <!-- Mobile Card List -->
      <div *ngIf="isMobile" class="space-y-4">
        <div
          *ngFor="let data of dataSet.data"
          class="p-4 bg-white rounded shadow flex flex-col gap-2"
        >
          <div>
            <span class="font-semibold">Accessed At:</span> {{ formatDateWithTime(data.accessedAt) }}
            WIB
          </div>
          <div><span class="font-semibold">Email:</span> {{ data.email || '-' }}</div>
          <div class="flex items-center justify-between">
            <span>
              <span class="font-semibold">IP Address:</span>
              {{ data.ipAddress === '::1' ? 'localhost (::1)' : data.ipAddress }}
            </span>
            <button
              nz-button
              nzType="text"
              nzSize="small"
              nz-tooltip="Copy IP"
              (click)="copyToClipboard(data.ipAddress)"
            >
              <nz-icon nzType="copy" nzTheme="outline"></nz-icon>
            </button>
          </div>
          <div class="flex items-center justify-between">
            <span><span class="font-semibold">User Agent:</span> {{ data.userAgent | userAgentParser }}</span>
            <button
              nz-button
              nzType="text"
              nzSize="small"
              nz-tooltip="Copy User Agent"
              (click)="copyToClipboard(data.userAgent)"
            >
              <nz-icon nzType="copy" nzTheme="outline"></nz-icon>
            </button>
          </div>
          <div><span class="font-semibold">Reason:</span> {{ data.reason }}</div>
        </div>

        <!-- Pagination Mobile -->
        <nz-pagination
          [nzPageIndex]="dataSet.page"
          [nzTotal]="dataSet.total"
          [nzPageSize]="dataSet.limit"
          (nzPageIndexChange)="onPageChange($event)"
          [nzSimple]="true"
          class="mt-4"
        >
        </nz-pagination>
      </div>
    </ng-template>
  </div>
</div>
